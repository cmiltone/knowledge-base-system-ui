import{K as u,_ as p,B as c,D as m,E as V,c as o,G as r,L as g,F as y,H as f,I as A,Q as v,N as n}from"./index-c247efdd.js";import{a as b}from"./article-fcfc2667.js";import{c as E,V as T}from"./VAutocomplete-bfb17823.js";import{C as R,V as $,a as D}from"./VFileInput-77dec791.js";import{V as U}from"./VDialog-11eb4ece.js";import{V as F,b as I}from"./VCard-b924c6ab.js";import{V as M}from"./VForm-7182cecd.js";import{V as k}from"./VTextField-7f1725b3.js";import{V as S}from"./VTextarea-45526073.js";import{V as d}from"./VBtn-886db63b.js";import{g as w}from"./index-5d552a30.js";import"./filter-1499cb31.js";import"./VInput-05702754.js";import"./index-9672de2e.js";import"./VAvatar-397c5db9.js";import"./tag-d920acd8.js";import"./VOverlay-ea1fb1c6.js";import"./scopeId-551e5591.js";import"./ssrBoot-d6f660a8.js";const{mapActions:B}=u("CREATE_ARTICLE"),{mapGetters:G,mapActions:L}=u("CATEGORY"),N={components:{CategoryForm:R},name:"ArticleForm",data:()=>({valid:!1,title:"",content:"",category:"",publish:!1,loadingCategories:!1,images:[],categoryDialog:!1}),computed:{...G(["categoryPage"]),user(){return this.$store.getters.user}},created(){this.fetchCategories()},methods:{...B(["createArticle"]),...L(["fetchCategoryList"]),getRules(e){return[t=>!!t||`${e} is required`]},save(){if(!this.valid)return;const e=new FormData;e.append("title",this.title),e.append("content",this.content),e.append("category",this.category),e.append("creator",this.user._id),e.append("status",this.publish?"published":"draft"),this.images.forEach(t=>e.append("files",t)),this.createArticle(e).then(t=>{t&&this.$router.push(`/article/${t._id}`)})},fetchCategories(e=""){this.loadingCategories=!0;let t="?status=active&limit=1000";e&&(t+=e),this.fetchCategoryList(t).then(s=>{s&&(this.loadingCategories=!1)})},searchCategories(e){e?this.fetchCategories(`&q=${e}`):this.fetchCategories()},addCategory(){this.categoryDialog=!0}},beforeCreate(){this.$store.hasModule("CREATE_ARTICLE")||this.$store.registerModule("CREATE_ARTICLE",b),this.$store.hasModule("CATEGORY")||this.$store.registerModule("CATEGORY",E)},beforeUnmount(){this.$store.unregisterModule("CREATE_ARTICLE"),this.$store.unregisterModule("CATEGORY")}},x=g("h1",{class:"mx-auto my-6 text-center",style:{"max-width":"500px"}}," Create Article ",-1);function O(e,t,s,h,C,l){const i=c("category-form");return m(),V(y,null,[o(U,{modelValue:e.categoryDialog,"onUpdate:modelValue":t[1]||(t[1]=a=>e.categoryDialog=a),persistent:"","max-width":"300"},{default:r(()=>[e.categoryDialog?(m(),f(i,{key:0,onCategorySaved:t[0]||(t[0]=a=>e.categoryDialog=!1)})):A("",!0)]),_:1},8,["modelValue"]),g("div",null,[x,o(F,{class:"mx-auto pa-12 pb-8",elevation:"8","max-width":"700",rounded:"lg"},{default:r(()=>[o(M,{modelValue:e.valid,"onUpdate:modelValue":t[7]||(t[7]=a=>e.valid=a),onSubmit:v(l.save,["prevent"])},{default:r(()=>[o(k,{modelValue:e.title,"onUpdate:modelValue":t[2]||(t[2]=a=>e.title=a),label:"Title",rules:l.getRules("Title"),placeholder:"Enter title",variant:"outlined"},null,8,["modelValue","rules"]),o(S,{modelValue:e.content,"onUpdate:modelValue":t[3]||(t[3]=a=>e.content=a),label:"Content",rules:l.getRules("Content"),density:"compact",placeholder:"Enter Content",variant:"outlined"},null,8,["modelValue","rules"]),o(T,{modelValue:e.category,"onUpdate:modelValue":t[4]||(t[4]=a=>e.category=a),label:"Category",rules:l.getRules("Category"),items:e.categoryPage.docs,"item-title":"name","item-value":"_id",placeholder:"Select Category",variant:"outlined","no-data-text":"No category","no-filter":!0,loading:e.loadingCategories,"onUpdate:search":l.searchCategories},{"no-data":r(()=>[o(d,{color:"blue",variant:"text",class:"ma-2",onClick:l.addCategory},{default:r(()=>[n("Add Category")]),_:1},8,["onClick"])]),_:1},8,["modelValue","rules","items","loading","onUpdate:search"]),o($,{modelValue:e.publish,"onUpdate:modelValue":t[5]||(t[5]=a=>e.publish=a),label:"Publish"},null,8,["modelValue"]),o(D,{modelValue:e.images,"onUpdate:modelValue":t[6]||(t[6]=a=>e.images=a),chips:"",label:"Images and/or Videos(optional, max: 4)",placeholder:"Select Images",multiple:"",variant:"outlined"},null,8,["modelValue"]),o(I,{class:"text-right"},{default:r(()=>[o(d,{class:"mx-3",color:"blue",variant:"tonal",type:"submit"},{default:r(()=>[n(" Save ")]),_:1}),o(d,{class:"mx-4",variant:"tonal",to:"/article",type:"button"},{default:r(()=>[o(w,{icon:"mdi-chevron-left"}),n(" Back ")]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1})])],64)}const Y=p(N,[["render",O]]),_={name:"ArticleView",components:{ArticleForm:Y}};function P(e,t,s,h,C,l){const i=c("article-form");return m(),f(i)}const de=p(_,[["render",P]]);export{de as default};
