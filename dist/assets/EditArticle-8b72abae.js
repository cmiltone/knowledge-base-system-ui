import{K as y,_,B as h,D as s,E as p,c as a,G as l,L as T,N as o,M as g,I as f,H as m,P as b,F as D,Q as R}from"./index-a293e11a.js";import{a as M}from"./article-aaf176f6.js";import{c as k,V as $}from"./VAutocomplete-984352b7.js";import{C as U,V as L,a as S}from"./VFileInput-b64068e3.js";import{V as B}from"./VDialog-f07f83f7.js";import{V as C,a as F,c as w,b as V,d as G}from"./VCard-2d52b043.js";import{d}from"./index-32067264.js";import{V as N}from"./VForm-e73661f2.js";import{V as O}from"./VTextField-4cf8a7a9.js";import{V as P}from"./VTextarea-3df8ac4c.js";import{V as u}from"./VBtn-c63c89fe.js";import{a as Y,V as q}from"./VRow-b2edefb6.js";import{V as x}from"./VAvatar-e7cde86f.js";import"./filter-46a1cd1e.js";import"./VInput-7c5570be.js";import"./index-64adca37.js";import"./VProgressLinear-cb5797f3.js";import"./VOverlay-9073929d.js";import"./scopeId-6c64961f.js";import"./ssrBoot-585b05d8.js";/* empty css              */const{mapActions:H}=y("EDIT_ARTICLE"),{mapGetters:j,mapActions:K}=y("EDIT_ARTICLE_CATEGORY"),Q="https://api.hagak.tech",z={name:"ArticleEditForm",components:{CategoryForm:U},data:()=>({valid:!1,fileBaseUrl:`${Q}/v1/file`,title:"",content:"",category:"",publish:!1,loadingCategories:!1,images:[],deletedMedia:[],categoryDialog:!1}),props:{articleId:{type:String,required:!0}},computed:{...j(["categoryPage"]),user(){return this.$store.getters.user},article(){return this.$store.getters["EDIT_ARTICLE/getArticle"](this.articleId)}},created(){this.fetchCategories(),this.fetchArticle(`?articleId=${this.articleId}`).then(e=>{var t;e&&(this.title=e.title,this.content=e.content,this.category=(t=e.category)==null?void 0:t._id,this.publish=e.status==="published")})},methods:{...H(["updateArticle","fetchArticle"]),...K(["fetchCategoryList"]),getRules(e){return[t=>!!t||`${e} is required`]},save(){if(!this.valid)return;const e=new FormData;e.append("articleId",this.articleId),e.append("title",this.title),e.append("content",this.content),e.append("category",this.category),e.append("creator",this.user._id),e.append("status",this.publish?"published":"draft"),this.images.forEach(t=>e.append("files",t)),e.append("deletedMedia",this.deletedMedia.join(",")),this.updateArticle(e).then(t=>{t&&this.$router.push(`/article/${t._id}`)})},fetchCategories(e=""){this.loadingCategories=!0;let t="?status=active&limit=1000";e&&(t+=e),this.fetchCategoryList(t).then(n=>{n&&(this.loadingCategories=!1)})},searchCategories(e){e?this.fetchCategories(`&q=${e}`):this.fetchCategories()},addCategory(){this.categoryDialog=!0},removeMedia(e){this.deletedMedia.push(e)},exitCat(e){this.categoryDialog=!1,e&&this.searchCategories(e.name)}},beforeCreate(){this.$store.hasModule("EDIT_ARTICLE")||this.$store.registerModule("EDIT_ARTICLE",M),this.$store.hasModule("EDIT_ARTICLE_CATEGORY")||this.$store.registerModule("EDIT_ARTICLE_CATEGORY",k)},beforeUnmount(){this.$store.unregisterModule("EDIT_ARTICLE"),this.$store.unregisterModule("EDIT_ARTICLE_CATEGORY")}},J={key:0},W={class:"ma-6"},X=["src"];function Z(e,t,n,I,E,i){const c=h("category-form"),v=h("router-link");return i.article?(s(),p("div",J,[a(B,{modelValue:e.categoryDialog,"onUpdate:modelValue":t[0]||(t[0]=r=>e.categoryDialog=r),persistent:"","max-width":"300"},{default:l(()=>[e.categoryDialog?(s(),m(c,{key:0,onCategorySaved:i.exitCat},null,8,["onCategorySaved"])):f("",!0)]),_:1},8,["modelValue"]),T("h1",W,[a(v,{to:"/article"},{default:l(()=>[o("Articles")]),_:1}),o(),a(d,{icon:"mdi-chevron-right"}),o(" Edit "),a(d,{icon:"mdi-chevron-right"}),o(" "+g(i.article.title),1)]),a(C,{class:"mx-auto pa-12 pb-8",elevation:"8","max-width":"700",rounded:"lg"},{default:l(()=>[a(N,{modelValue:e.valid,"onUpdate:modelValue":t[6]||(t[6]=r=>e.valid=r),onSubmit:b(i.save,["prevent"])},{default:l(()=>[a(O,{modelValue:e.title,"onUpdate:modelValue":t[1]||(t[1]=r=>e.title=r),label:"Title",rules:i.getRules("Title"),placeholder:"Enter title",variant:"outlined"},null,8,["modelValue","rules"]),a(P,{modelValue:e.content,"onUpdate:modelValue":t[2]||(t[2]=r=>e.content=r),label:"Content",rules:i.getRules("Content"),density:"compact",placeholder:"Enter Content",variant:"outlined"},null,8,["modelValue","rules"]),a($,{modelValue:e.category,"onUpdate:modelValue":t[3]||(t[3]=r=>e.category=r),label:"Category",rules:i.getRules("Category"),items:e.categoryPage.docs,"item-title":"name","item-value":"_id",placeholder:"Select Category",variant:"outlined","no-data-text":"No category","no-filter":!0,loading:e.loadingCategories,"onUpdate:search":i.searchCategories},{append:l(()=>[a(u,{color:"blue",variant:"text",class:"ma-2",onClick:i.addCategory},{default:l(()=>[a(d,{icon:"mdi-plus"})]),_:1},8,["onClick"])]),_:1},8,["modelValue","rules","items","loading","onUpdate:search"]),a(L,{modelValue:e.publish,"onUpdate:modelValue":t[4]||(t[4]=r=>e.publish=r),label:"Publish"},null,8,["modelValue"]),a(Y,{class:"my-4"},{default:l(()=>[(s(!0),p(D,null,R(i.article.media,(r,A)=>(s(),m(q,{key:r._id,cols:"12",sm:"4"},{default:l(()=>[a(C,{"max-width":"210"},{default:l(()=>[a(F,null,{default:l(()=>[o("Media #"+g(A+1),1)]),_:2},1024),a(w,null,{default:l(()=>[o("Type: "+g(r.type),1)]),_:2},1024),a(V,null,{default:l(()=>[r.type==="image"?(s(),m(x,{key:0,height:"200",src:`${e.fileBaseUrl}/${r.thumbnail}`},null,8,["src"])):(s(),p("video",{key:1,height:"200",src:`${e.fileBaseUrl}/${r.filename}`,controls:""},null,8,X))]),_:2},1024),a(G,null,{default:l(()=>[a(u,{title:"Delete Media",color:"red",onClick:re=>i.removeMedia(r._id)},{default:l(()=>[a(d,{icon:"mdi-delete"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),a(S,{modelValue:e.images,"onUpdate:modelValue":t[5]||(t[5]=r=>e.images=r),chips:"",label:"Images and/or Videos(optional, max: 4)",placeholder:"Select Images",multiple:"",variant:"outlined",hint:`Upload to overwrite ${i.article.media.length} media already uploaded`},null,8,["modelValue","hint"]),a(V,{class:"text-right"},{default:l(()=>[a(u,{class:"mx-3",color:"blue",variant:"tonal",type:"submit"},{default:l(()=>[o(" Save ")]),_:1}),a(u,{class:"mx-4",variant:"tonal",to:"/article",type:"button"},{default:l(()=>[a(d,{icon:"mdi-chevron-left"}),o(" Back ")]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1})])):f("",!0)}const ee=_(z,[["render",Z]]),te={name:"EditArticle",components:{ArticleEditForm:ee},props:{articleId:{type:String,required:!0}}};function ae(e,t,n,I,E,i){const c=h("article-edit-form");return s(),m(c,{articleId:n.articleId},null,8,["articleId"])}const Te=_(te,[["render",ae]]);export{Te as default};
