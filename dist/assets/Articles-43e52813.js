import{K as f,_ as y,B as A,D as g,H as h,G as a,c as r,N as d,I as _,M as p,L as C}from"./index-82e8bfa7.js";import{r as I}from"./filters-501557af.js";import{a as T}from"./article-e618b049.js";import{c as L,V}from"./VAutocomplete-f53fdc75.js";import{V as $}from"./VDataTableServer-1c6d3a8a.js";import{V as S}from"./VContainer-ab4a1db7.js";import{V as m,a as R}from"./VRow-b0f7e36e.js";import{V as E}from"./VTextField-3bbe9387.js";import{V as u}from"./VBtn-94554fdc.js";import"./filter-2328cb3f.js";import"./VInput-29ae72a2.js";import"./index-eb4358f1.js";import"./VAvatar-7679238b.js";import"./index-60619a3d.js";import"./tag-c3595aa8.js";import"./VOverlay-f1d929c1.js";import"./scopeId-750b4cc2.js";import"./ssrBoot-a824542f.js";/* empty css              */const{mapGetters:M,mapActions:v}=f("ARTICLE_LIST"),{mapGetters:P,mapActions:b}=f("LIST_ARTICLE_CATEGORY"),N={name:"ArticleList",components:{VDataTableServer:$},data:()=>({loadingCategories:!1,headers:[{key:"title",title:"Title",sortable:!0},{key:"category.name",title:"Category"},{key:"creator.fullName",title:"Created By"},{key:"createdAt",title:"Created On"},{key:"status",title:"Status"},{key:"action",title:"Action"}],limit:10,hasPrevPage:!1,hasNextPage:!1,page:1,totalPages:0,loading:!1,categoryId:""}),created(){this.$route.query.categoryId?this.categoryId=this.$route.query.categoryId:this.fetchArticles(),this.fetchCategories()},computed:{...M(["articlePage"]),...P(["categoryPage"]),user(){return this.$store.getters.user}},watch:{categoryId:"searchByCategory"},methods:{...v(["fetchArticleList"]),...b(["fetchCategoryList"]),readableDate:I,searchArticle(e){const t=e.target.value;t?this.fetchArticles(`&q=${t}`):this.fetchArticles()},fetchArticles(e=""){this.loading=!0;let t=`?limit=${this.limit}&page=${this.page}`;const o=this.user.role==="user"?"&status=published":"",c=this.user.role==="creator"?`&userId=${this.user._id}`:"";t+=o,t+=e,t+=c,this.fetchArticleList(t).then(l=>{l&&(this.page=l.page,this.limit=l.limit,this.loading=!1)})},setOptions(e){this.page=e.page,this.limit=e.itemsPerPage,this.fetchArticles()},fetchCategories(e=""){this.loadingCategories=!0;let t="?status=active&limit=1000";e&&(t+=e),this.fetchCategoryList(t).then(o=>{o&&(this.loadingCategories=!1)})},searchCategories(e){e?this.fetchCategories(`&q=${e}`):this.fetchCategories()},searchByCategory(){this.categoryId&&this.fetchArticles(`&categoryId=${this.categoryId}`)}},beforeCreate(){this.$store.hasModule("ARTICLE_LIST")||this.$store.registerModule("ARTICLE_LIST",T),this.$store.hasModule("LIST_ARTICLE_CATEGORY")||this.$store.registerModule("LIST_ARTICLE_CATEGORY",L)},beforeUnmount(){this.$store.unregisterModule("ARTICLE_LIST"),this.$store.unregisterModule("LIST_ARTICLE_CATEGORY")}},k=C("h1",null,"Articles",-1),G={class:"text-capitalize"};function B(e,t,o,c,l,i){const n=A("v-data-table-server");return g(),h(S,null,{default:a(()=>[r(R,null,{default:a(()=>[r(m,{cols:"2"},{default:a(()=>[k]),_:1}),r(m,{cols:"8",style:{display:"flex"}},{default:a(()=>[r(E,{class:"mx-2",placeholder:"Search articles","prepend-icon":"mdi-magnify",onKeyup:i.searchArticle},null,8,["onKeyup"]),r(V,{modelValue:e.categoryId,"onUpdate:modelValue":t[0]||(t[0]=s=>e.categoryId=s),items:e.categoryPage.docs,"item-title":"name","item-value":"_id",placeholder:"Filter by Category","no-data-text":"No categories to display",class:"mx-2","no-filter":!0,loading:e.loadingCategories,"onUpdate:search":i.searchCategories},null,8,["modelValue","items","loading","onUpdate:search"])]),_:1}),r(m,{cols:"2"},{default:a(()=>[i.user.role==="creator"?(g(),h(u,{key:0,to:"/article/new"},{default:a(()=>[d(" Create ")]),_:1})):_("",!0)]),_:1})]),_:1}),r(n,{page:e.page,"onUpdate:page":t[1]||(t[1]=s=>e.page=s),"fixed-header":"",headers:e.headers,items:e.articlePage.docs,"items-per-page":e.limit,"items-length":e.articlePage.totalDocs,loading:e.loading,"loading-text":"Fetching articles...","no-data-text":"No articles to display",class:"elevation-1","onUpdate:options":i.setOptions},{"item.createdAt":a(({item:s})=>[d(p(i.readableDate(s.createdAt,"MMM Do, YYYY h:mmA")),1)]),"item.status":a(({item:s})=>[C("span",G,p(s.status),1)]),"item.action":a(({item:s})=>[r(u,{size:"x-small",color:"primary",to:`/article/${s._id}`},{default:a(()=>[d("View")]),_:2},1032,["to"])]),_:2},1032,["page","headers","items","items-per-page","items-length","loading","onUpdate:options"])]),_:1})}const Y=y(N,[["render",B]]),D={name:"ArticleView",components:{ArticleList:Y}};function O(e,t,o,c,l,i){const n=A("article-list");return g(),h(n)}const ie=y(D,[["render",O]]);export{ie as default};
