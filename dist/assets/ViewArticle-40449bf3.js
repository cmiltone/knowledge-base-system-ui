import{J as A,K as T,_ as b,D as n,E as f,c as a,G as r,L as m,M as g,F as V,R as C,N as u,H as h,B as E,I as p}from"./index-c247efdd.js";import{a as S}from"./article-fcfc2667.js";import{r as R}from"./filters-501557af.js";import{a as L,V as $}from"./VRow-a34a8c43.js";import{V as B}from"./VOverlay-ea1fb1c6.js";import{V as D}from"./VTextarea-45526073.js";import{V as y}from"./VBtn-886db63b.js";import{V as G}from"./scopeId-551e5591.js";import{V as U}from"./VDialog-11eb4ece.js";import{V as k,a as I,c as q,b as w,d as x}from"./VCard-b924c6ab.js";import{V as M}from"./VAvatar-397c5db9.js";import{g as v,h as Y}from"./index-5d552a30.js";/* empty css              */import"./tag-d920acd8.js";import"./VInput-05702754.js";import"./index-9672de2e.js";import"./ssrBoot-d6f660a8.js";const O={namespaced:!0,state:()=>({}),getters:{},mutations:{},actions:{async createEngagement(e,l){return await A.post("/v1/engagement",l).then(s=>(e.dispatch("setToast",{title:"Success",type:"success",text:""},{root:!0}),s.data)).catch(s=>{var d,c,t;e.dispatch("setToast",{title:"Request failed!",type:"error",text:(t=(c=(d=s.response)==null?void 0:d.data)==null?void 0:c.error)==null?void 0:t.message},{root:!0})})},async updateEngagement(e,l){return await A.put("/v1/engagement",l).then(s=>(e.dispatch("setToast",{title:"Success",type:"success",text:""},{root:!0}),s.data.engagement)).catch(s=>{var d,c,t;e.dispatch("setToast",{title:"Request failed!",type:"error",text:(t=(c=(d=s.response)==null?void 0:d.data)==null?void 0:c.error)==null?void 0:t.message},{root:!0})})},deleteEngagement(e,l){A.delete(`/v1/engagement${l}`).then(s=>{e.commit("REMOVE_CATEGORY",s.data),e.dispatch("setToast",{title:"Success",type:"success",text:"Engagement deleted"},{root:!0})}).catch(s=>{var d,c,t;e.dispatch("setToast",{title:"Request failed!",type:"error",text:(t=(c=(d=s.response)==null?void 0:d.data)==null?void 0:c.error)==null?void 0:t.message},{root:!0})})}}},F=O,{mapActions:H}=T("ENGAGE"),P={name:"CommentList",props:{engagement:{type:Object,required:!0}},data:()=>({message:""}),computed:{user(){return this.$store.getters.user}},methods:{readableDate:R,...H(["createEngagement"]),like(){this.createEngagement({articleId:this.engagement.article,likes:[{user:this.user._id}]}).then(e=>{e&&this.$emit("saved",e)})},addComment(){this.message&&this.createEngagement({articleId:this.engagement.article,comments:[{user:this.user._id,message:this.message}]}).then(e=>{e&&this.$emit("saved",e)})}},beforeCreate(){this.$store.hasModule("ENGAGE")||this.$store.registerModule("ENGAGE",F)},beforeUnmount(){this.$store.unregisterModule("ENGAGE")}};const j={class:"likers"},z=m("h4",null,"Comments: ",-1);function J(e,l,s,d,c,t){return n(),f(V,null,[a(L,null,{default:r(()=>[a($,{cols:"10"},{default:r(()=>[a(D,{modelValue:e.message,"onUpdate:modelValue":l[0]||(l[0]=o=>e.message=o),label:"Comment",placeholder:"Share your views here..."},null,8,["modelValue"])]),_:1}),a($,{cols:"2"},{default:r(()=>[a(y,{color:"blue",icon:"mdi-send",onClick:t.addComment},null,8,["onClick"]),u("   ")]),_:1})]),_:1}),m("h4",{class:"likes",onClick:l[1]||(l[1]=(...o)=>t.like&&t.like(...o))},g(s.engagement.likes.length+` Like${s.engagement.likes.length>1?"s":""}`),1),m("div",j,[(n(!0),f(V,null,C(s.engagement.likes,o=>(n(),f("div",{key:o._id},g(`~ ${o.user.fullName}`),1))),128))]),z,a(B,{lines:"two"},{default:r(()=>[(n(!0),f(V,null,C(s.engagement.comments,o=>(n(),h(G,{key:o._id,title:o.message,subtitle:`~ ${o.user.fullName}`},null,8,["title","subtitle"]))),128))]),_:1})],64)}const K=b(P,[["render",J]]),Q="http://localhost:8800",{mapActions:W}=T("ARTICLE"),X={components:{Engagement:K},name:"ArticleView",data:()=>({loading:!1,fileBaseUrl:`${Q}/v1/file`,media:void 0,mediaDialog:!1}),props:{articleId:{type:String,required:!0}},computed:{article(){return this.$store.getters["ARTICLE/getArticle"](this.articleId)},user(){return this.$store.getters.user}},created(){this.loading=!0,this.getArticle()},methods:{...W(["createArticle","fetchArticle"]),getRules(e){return[l=>!!l||`${e} is required`]},readableDate:R,viewMedia(e){this.media=e,this.mediaDialog=!0},getArticle(){this.fetchArticle(`?articleId=${this.articleId}`).then(e=>{e&&(this.loading=!1)})}},beforeCreate(){this.$store.hasModule("ARTICLE")||this.$store.registerModule("ARTICLE",S)},beforeUnmount(){this.$store.unregisterModule("ARTICLE")}},Z={key:0},ee=["src"],te={class:"text-right"},ae={class:"ma-6"},re={class:"mt-4"},se=["src"],le=m("br",null,null,-1),ie=m("br",null,null,-1);function ne(e,l,s,d,c,t){const o=E("router-link"),N=E("engagement");return t.article?(n(),f("div",Z,[a(U,{modelValue:e.mediaDialog,"onUpdate:modelValue":l[1]||(l[1]=i=>e.mediaDialog=i),"max-width":"80%","max-height":"80%"},{default:r(()=>[e.media?(n(),h(k,{key:0},{default:r(()=>[a(I,null,{default:r(()=>[u(g(e.media.title),1)]),_:1}),e.media.type==="image"?(n(),h(M,{key:0,src:`${e.fileBaseUrl}/${e.media.filename}`,height:"600"},null,8,["src"])):(n(),f("video",{key:1,height:"600",controls:"",src:`${e.fileBaseUrl}/${e.media.filename}`},null,8,ee)),m("div",te,[a(y,{color:"blue",onClick:l[0]||(l[0]=i=>e.mediaDialog=!1)},{default:r(()=>[u("Close")]),_:1})])]),_:1})):p("",!0)]),_:1},8,["modelValue"]),m("h1",ae,[a(o,{to:"/article"},{default:r(()=>[u("Articles")]),_:1}),u(),a(v,{icon:"mdi-chevron-right"}),u(" "+g(t.article.title),1)]),a(k,{loading:e.loading,class:"mx-auto pa-12 pb-8",elevation:"8","max-width":"900",rounded:"lg"},{loader:r(({isActive:i})=>[a(Y,{active:i,color:"deep-purple",height:"4",indeterminate:""},null,8,["active"])]),default:r(()=>[a(I,null,{default:r(()=>{var i;return[u("Category: "),a(o,{to:`/article?categoryId=${(i=t.article.category)==null?void 0:i._id}`},{default:r(()=>{var _;return[u(g((_=t.article.category)==null?void 0:_.name),1)]}),_:1},8,["to"])]}),_:1}),a(q,{class:""},{default:r(()=>{var i,_;return[m("div",null,[u(" Posted by: "),m("b",null,g((i=t.article.creator)==null?void 0:i.fullName),1),u(", "+g(t.readableDate(t.article.createdAt,"MMM Do, YYYY h:mmA"))+"   ",1),((_=t.article.creator)==null?void 0:_._id)===t.user._id||t.user.role==="admin"?(n(),h(y,{key:0,class:"mx-4",variant:"tonal",to:`/article/edit/${t.article._id}`,color:"blue",rounded:"",size:"sm"},{default:r(()=>[a(v,{icon:"mdi-pencil"}),u(" Edit ")]),_:1},8,["to"])):p("",!0)])]}),_:1}),a(w,null,{default:r(()=>[m("p",re,g(t.article.content),1),a(L,{class:"my-4"},{default:r(()=>[(n(!0),f(V,null,C(t.article.media,i=>(n(),h($,{key:i._id,cols:"12",sm:"4"},{default:r(()=>[a(k,{"max-width":"210"},{default:r(()=>[a(w,null,{default:r(()=>[i.type==="image"?(n(),h(M,{key:0,height:"200",src:`${e.fileBaseUrl}/${i.thumbnail}`},null,8,["src"])):(n(),f("video",{key:1,height:"200",src:`${e.fileBaseUrl}/${i.filename}`,controls:""},null,8,se))]),_:2},1024),a(x,null,{default:r(()=>[a(y,{title:"View Media",color:"blue",onClick:_=>t.viewMedia(i)},{default:r(()=>[a(v,{icon:"mdi-arrow-expand-all"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),le,ie,t.article.engagement?(n(),h(N,{key:0,engagement:t.article.engagement,onSaved:t.getArticle},null,8,["engagement","onSaved"])):p("",!0)]),_:1})]),_:1},8,["loading"])])):p("",!0)}const oe=b(X,[["render",ne]]),de={name:"ViewArticle",components:{ArticleView:oe},props:{articleId:{type:String,required:!0}}};function ce(e,l,s,d,c,t){const o=E("article-view");return n(),h(o,{articleId:s.articleId},null,8,["articleId"])}const we=b(de,[["render",ce]]);export{we as default};
