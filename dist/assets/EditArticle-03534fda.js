import{K as y,_ as I,B as h,D as s,E as p,c as a,G as r,L as T,N as i,M as g,I as f,H as m,Q as b,F as D,R}from"./index-c247efdd.js";import{a as $}from"./article-fcfc2667.js";import{c as M,V as k}from"./VAutocomplete-bfb17823.js";import{C as U,V as L,a as S}from"./VFileInput-77dec791.js";import{V as B}from"./VDialog-11eb4ece.js";import{V,a as F,c as w,b as C,d as G}from"./VCard-b924c6ab.js";import{g as n}from"./index-5d552a30.js";import{V as N}from"./VForm-7182cecd.js";import{V as O}from"./VTextField-7f1725b3.js";import{V as Y}from"./VTextarea-45526073.js";import{V as u}from"./VBtn-886db63b.js";import{a as q,V as P}from"./VRow-a34a8c43.js";import{V as H}from"./VAvatar-397c5db9.js";import"./filter-1499cb31.js";import"./VInput-05702754.js";import"./index-9672de2e.js";import"./VOverlay-ea1fb1c6.js";import"./scopeId-551e5591.js";import"./tag-d920acd8.js";import"./ssrBoot-d6f660a8.js";/* empty css              */const{mapActions:j}=y("EDIT_ARTICLE"),{mapGetters:K,mapActions:Q}=y("EDIT_ARTICLE_CATEGORY"),x="http://localhost:8800",z={name:"ArticleEditForm",components:{CategoryForm:U},data:()=>({valid:!1,fileBaseUrl:`${x}/v1/file`,loading:!1,title:"",content:"",category:"",publish:!1,loadingCategories:!1,images:[],deletedMedia:[],categoryDialog:!1}),props:{articleId:{type:String,required:!0}},computed:{...K(["categoryPage"]),user(){return this.$store.getters.user},article(){return this.$store.getters["EDIT_ARTICLE/getArticle"](this.articleId)}},created(){this.fetchCategories(),this.loading=!0,this.fetchArticle(`?articleId=${this.articleId}`).then(e=>{var t;e&&(this.loading=!1,this.title=e.title,this.content=e.content,this.category=(t=e.category)==null?void 0:t._id,this.publish=e.status==="published")})},methods:{...j(["updateArticle","fetchArticle"]),...Q(["fetchCategoryList"]),getRules(e){return[t=>!!t||`${e} is required`]},save(){if(!this.valid)return;const e=new FormData;e.append("articleId",this.articleId),e.append("title",this.title),e.append("content",this.content),e.append("category",this.category),e.append("creator",this.user._id),e.append("status",this.publish?"published":"draft"),this.images.forEach(t=>e.append("files",t)),e.append("deletedMedia",this.deletedMedia.join(",")),this.updateArticle(e).then(t=>{t&&this.$router.push(`/article/${t._id}`)})},fetchCategories(e=""){this.loadingCategories=!0;let t="?status=active&limit=1000";e&&(t+=e),this.fetchCategoryList(t).then(d=>{d&&(this.loadingCategories=!1)})},searchCategories(e){e?this.fetchCategories(`&q=${e}`):this.fetchCategories()},addCategory(){this.categoryDialog=!0},removeMedia(e){this.deletedMedia.push(e)}},beforeCreate(){this.$store.hasModule("EDIT_ARTICLE")||this.$store.registerModule("EDIT_ARTICLE",$),this.$store.hasModule("EDIT_ARTICLE_CATEGORY")||this.$store.registerModule("EDIT_ARTICLE_CATEGORY",M)},beforeUnmount(){this.$store.unregisterModule("EDIT_ARTICLE"),this.$store.unregisterModule("EDIT_ARTICLE_CATEGORY")}},J={key:0},W={class:"ma-6"},X=["src"];function Z(e,t,d,E,_,o){const c=h("category-form"),v=h("router-link");return o.article?(s(),p("div",J,[a(B,{modelValue:e.categoryDialog,"onUpdate:modelValue":t[1]||(t[1]=l=>e.categoryDialog=l),persistent:"","max-width":"300"},{default:r(()=>[e.categoryDialog?(s(),m(c,{key:0,onCategorySaved:t[0]||(t[0]=l=>e.categoryDialog=!1)})):f("",!0)]),_:1},8,["modelValue"]),T("h1",W,[a(v,{to:"/article"},{default:r(()=>[i("Articles")]),_:1}),i(),a(n,{icon:"mdi-chevron-right"}),i(" Edit "),a(n,{icon:"mdi-chevron-right"}),i(" "+g(o.article.title),1)]),a(V,{class:"mx-auto pa-12 pb-8",elevation:"8","max-width":"700",rounded:"lg"},{default:r(()=>[a(N,{modelValue:e.valid,"onUpdate:modelValue":t[7]||(t[7]=l=>e.valid=l),onSubmit:b(o.save,["prevent"])},{default:r(()=>[a(O,{modelValue:e.title,"onUpdate:modelValue":t[2]||(t[2]=l=>e.title=l),label:"Title",rules:o.getRules("Title"),placeholder:"Enter title",variant:"outlined"},null,8,["modelValue","rules"]),a(Y,{modelValue:e.content,"onUpdate:modelValue":t[3]||(t[3]=l=>e.content=l),label:"Content",rules:o.getRules("Content"),density:"compact",placeholder:"Enter Content",variant:"outlined"},null,8,["modelValue","rules"]),a(k,{modelValue:e.category,"onUpdate:modelValue":t[4]||(t[4]=l=>e.category=l),label:"Category",rules:o.getRules("Category"),items:e.categoryPage.docs,"item-title":"name","item-value":"_id",placeholder:"Select Category",variant:"outlined","no-data-text":"No category","no-filter":!0,loading:e.loadingCategories,"onUpdate:search":o.searchCategories},{"no-data":r(()=>[a(u,{color:"blue",variant:"text",class:"ma-2",onClick:o.addCategory},{default:r(()=>[i("Add Category")]),_:1},8,["onClick"])]),_:1},8,["modelValue","rules","items","loading","onUpdate:search"]),a(L,{modelValue:e.publish,"onUpdate:modelValue":t[5]||(t[5]=l=>e.publish=l),label:"Publish"},null,8,["modelValue"]),a(q,{class:"my-4"},{default:r(()=>[(s(!0),p(D,null,R(o.article.media,(l,A)=>(s(),m(P,{key:l._id,cols:"12",sm:"4"},{default:r(()=>[a(V,{"max-width":"210"},{default:r(()=>[a(F,null,{default:r(()=>[i("Media #"+g(A+1),1)]),_:2},1024),a(w,null,{default:r(()=>[i("Type: "+g(l.type),1)]),_:2},1024),a(C,null,{default:r(()=>[l.type==="image"?(s(),m(H,{key:0,height:"200",src:`${e.fileBaseUrl}/${l.thumbnail}`},null,8,["src"])):(s(),p("video",{key:1,height:"200",src:`${e.fileBaseUrl}/${l.filename}`,controls:""},null,8,X))]),_:2},1024),a(G,null,{default:r(()=>[a(u,{title:"Delete Media",color:"red",onClick:le=>o.removeMedia(l._id)},{default:r(()=>[a(n,{icon:"mdi-delete"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),a(S,{modelValue:e.images,"onUpdate:modelValue":t[6]||(t[6]=l=>e.images=l),chips:"",label:"Images and/or Videos(optional, max: 4)",placeholder:"Select Images",multiple:"",variant:"outlined",hint:`Upload to overwrite ${o.article.media.length} media already uploaded`},null,8,["modelValue","hint"]),a(C,{class:"text-right"},{default:r(()=>[a(u,{class:"mx-3",color:"blue",variant:"tonal",type:"submit"},{default:r(()=>[i(" Save ")]),_:1}),a(u,{class:"mx-4",variant:"tonal",to:"/article",type:"button"},{default:r(()=>[a(n,{icon:"mdi-chevron-left"}),i(" Back ")]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1})])):f("",!0)}const ee=I(z,[["render",Z]]),te={name:"EditArticle",components:{ArticleEditForm:ee},props:{articleId:{type:String,required:!0}}};function ae(e,t,d,E,_,o){const c=h("article-edit-form");return s(),m(c,{articleId:d.articleId},null,8,["articleId"])}const Te=I(te,[["render",ae]]);export{Te as default};
